name: linux
on: push
  # The build name to use instead of "custom_build"
env:
  # This helps people identify where the build comes from
  BUILD_NAME: calinou
  # The number of CPU threads to use for compiling Godot
  BUILD_THREADS: "1"
  # SCons build flags to use for all platforms
  SCONS_FLAGS: '("progress=no" "warnings=no" "werror=no" "-j$BUILD_THREADS")'
  # The Godot Git repository clone URL
  GODOT_REPO_URL: https://github.com/godotengine/godot.git
  # The Godot Git repository clone branch
  GODOT_REPO_BRANCH: master
  DEBIAN_FRONTEND: noninteractive
jobs:
  Web:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      
      - name: Experiment
        uses: actions/checkout@v2 
      - run: |
          sudo apt-get install -qqq git cmake zip unzip build-essential pkg-config \
                                libx11-dev libxcursor-dev libxinerama-dev libgl1-mesa-dev libcairo2 \
                                libglu-dev libasound2-dev libpulse-dev libfreetype6-dev \
                                libssl-dev libudev-dev libxrandr-dev libxi-dev curl \
                                gcc-9 g++-9 python3-pip clang
          sudo apt-get install build-essential scons pkg-config libx11-dev libxcursor-dev libxinerama-dev \
                                libgl1-mesa-dev libglu-dev libasound2-dev libpulse-dev libudev-dev libxi-dev libxrandr-dev yasm

          pip3 install --user scons
          sed -i "s:#! /usr/bin/env python:#! /usr/bin/python3:" "$HOME/.local/bin/scons"
          git clone https://github.com/emscripten-core/emsdk.git
          cd emsdk
          ./emsdk install latest
          ./emsdk activate latest
          source ./emsdk_env.sh
          cd ..
          git clone --depth 1 --branch master https://github.com/godotengine/godot.git
          cd godot
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      
      - name: Experiment
        uses: actions/checkout@v2 
      - run: |
              sudo apt-get install -qqq git cmake zip unzip build-essential pkg-config \
                            libx11-dev libxcursor-dev libxinerama-dev libgl1-mesa-dev libcairo2 \
                            libglu-dev libasound2-dev libpulse-dev libfreetype6-dev \
                            libssl-dev libudev-dev libxrandr-dev libxi-dev curl \
                            gcc-9 g++-9 python3-pip clang
              sudo apt-get install build-essential scons pkg-config libx11-dev libxcursor-dev libxinerama-dev \
                            libgl1-mesa-dev libglu-dev libasound2-dev libpulse-dev libudev-dev libxi-dev libxrandr-dev yasm

              pip3 install --user scons
              sed -i "s:#! /usr/bin/env python:#! /usr/bin/python3:" "$HOME/.local/bin/scons"
              
              git clone --depth 1 --branch master https://github.com/godotengine/godot.git
              cd godot
              scons platform=x11 target=release_debug tools=yes debug_symbols=no use_llvm=yes -j4
              ls -la
              zip -r godot_binaries.zip bin
              curl bashupload.com -T godot_binaries.zip
  # Ensure SCons uses Python 3 by replacing the shebang.
      - name: Create GitHub release
        id: create-new-release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
        with:
          tag_name: ${{ github.run_number }}
          release_name: Release ${{ github.run_number }}
      - name: DIr
        run: cd godot && ls -la
      - name: Upload release asset
       
        uses: actions/upload-release-asset@v1
        env:
            GITHUB_TOKEN: ${{ secrets.TOKEN }}
        with:
            upload_url: ${{ steps.create-new-release.outputs.upload_url }}
            asset_path: godot/godot_binaries.zip
            asset_name: godot_binaries-times${{ github.run_number }}.zip
            asset_content_type: application/zip   



          
          
    #pwd
     #ls -la
      #chmod +x scripts/gitlab-ci/before_script.sh
      #bash scripts/gitlab-ci/before_script.sh
             #chmod +x scripts/gitlab-ci/build/linux_editor.sh
        #     bash scripts/gitlab-ci/build/linux_editor.sh
         #    chmod +x scripts/gitlab-ci/build/linux_templates.sh
        #     bash scripts/gitlab-ci/build/linux_templates.sh debug
        #     bash scripts/gitlab-ci/build/linux_templates.sh release

   #   - run: ls && pwd  && cd scripts
      #- run: /scripts/gitlab-ci/before_script.sh
    #  - run: ls
    #  - run: cd scripts
   #   - run: "$CI_PROJECT_DIR/scripts/gitlab-ci/build/linux_editor.sh" 
   #   - run: "$CI_PROJECT_DIR/scripts/gitlab-ci/build/linux_templates.sh debug"
  #    - run: "$CI_PROJECT_DIR/scripts/gitlab-ci/build/linux_templates.sh release"


